"use strict";window.XdUtils=window.XdUtils||function(){function a(a,b){var c,d=b||{};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d}return{extend:a}}(),window.xdLocalStorage=window.xdLocalStorage||function(){function a(a){j[a.id]&&(j[a.id](a),delete j[a.id])}function b(b){var c;try{c=JSON.parse(b.data)}catch(d){}c&&c.namespace===g&&("iframe-ready"===c.id?(l=!0,h.initCallback(c.localStorageSupported)):a(c))}function c(a,b,c,d){i++,j[i]=d;var e={namespace:g,id:i,action:a,key:b,value:c};f.contentWindow.postMessage(JSON.stringify(e),"*")}function d(a){h=XdUtils.extend(a,h);var c=document.createElement("div");window.addEventListener?window.addEventListener("message",b,!1):window.attachEvent("onmessage",b),c.innerHTML='<iframe id="'+h.iframeId+'" src='+h.iframeUrl+' style="display: none;"></iframe>',document.body.appendChild(c),f=document.getElementById(h.iframeId)}function e(){return k?l?!0:(console.log("You must wait for iframe ready message before using the api."),!1):(console.log("You must call xdLocalStorage.init() before using it."),!1)}var f,g="cross-domain-local-message",h={iframeId:"cross-domain-iframe",iframeUrl:void 0,initCallback:function(){}},i=-1,j={},k=!1,l=!0;return{init:function(a){if(!a.iframeUrl)throw"You must specify iframeUrl";return k?void console.log("xdLocalStorage was already initialized!"):(k=!0,void("complete"===document.readyState?d(a):window.onload=function(){d(a)}))},setItem:function(a,b,d){e()&&c("set",a,b,d)},getItem:function(a,b){e()&&c("get",a,null,b)},removeItem:function(a,b){e()&&c("remove",a,null,b)},key:function(a,b){e()&&c("key",a,null,b)},getAllKeys:function(a,b){e()&&c("getAllKeys",a,null,b)},clear:function(a){e()&&c("clear",null,null,a)},wasInit:function(){return k}}}(),angular.module("xdLocalStorage",[]).service("xdLocalStorage",["$q",function(a){function b(){return xdLocalStorage.wasInit()||(d.reject(),console.warn("You must init xdLocalStorage in app config before use")),d.promise}function c(c){var d=Array.prototype.slice.call(arguments,1);return b().then(function(){var b=a.defer();return xdLocalStorage[c].apply(this,d.concat(function(){var a=arguments[0];b.resolve(a)})),b.promise})}var d=a.defer();return{init:function(b){var c=a.defer();return b.initCallback=function(a){a?(d.resolve(),c.resolve()):(d.reject(),c.reject(),console.warn("localStorage not supported in iframe"))},xdLocalStorage.init(b),c.promise},setItem:function(a,b){return c("setItem",a,b)},getItem:function(a){return c("getItem",a)},removeItem:function(a){return c("removeItem",a)},key:function(a){return c("key",a)},getAllKeys:function(a){return c("getAllKeys",a)},clear:function(){return c("clear")}}}]);